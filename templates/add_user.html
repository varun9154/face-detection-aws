{% extends "base.html" %}

{% block content %}
<div class="card" style="max-width: 600px; margin: 0 auto;">
    <h2>Register New User</h2>
    <p>Upload a clear photo of the person's face.</p>

    <form id="addUserForm" enctype="multipart/form-data">
        <label>Full Name</label>
        <input type="text" name="name" required placeholder="Ex: John Doe">

        <br><br>

        <label>Age</label>
        <input type="number" name="age" required placeholder="Ex: 30">

        <br><br>

        <label>Photo</label>
        <input type="file" name="file" accept=".jpg,.jpeg,.png" required
               style="background:white;color:black;">

        <br><br>

        <button type="submit" style="width:100%;font-size:1.1rem;">
            Register & Train
        </button>
    </form>

    <p id="message" style="margin-top:15px;font-weight:bold;"></p>
</div>

<script>
document.getElementById("addUserForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const msg = document.getElementById("message");
    const formData = new FormData(this);

    msg.style.color = "white";
    msg.innerText = "Uploading...";

    try {
        const res = await fetch("/add_user", {
            method: "POST",
            body: formData
        });

        const data = await res.json();

        if (data.success) {
            msg.style.color = "lightgreen";
            msg.innerText = data.message;
            this.reset();
        } else {
            msg.style.color = "red";
            msg.innerText = data.message;
        }
    } catch (err) {
        msg.style.color = "red";
        msg.innerText = "Server error. Please try again.";
    }
});
</script>
{% endblock %}
